<!-- src/app/components/f1-dashboard/f1-dashboard.component.html -->

<div class="control-section">
    <h1>F1 {{ currentYear }} Dashboard - LiveTiming Data</h1>
    
    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading">
      <p>Cargando datos de la temporada {{ currentYear }}...</p>
    </div>
  
    <!-- Error State -->
    <div *ngIf="errorMessage" class="error-message">
      <p>{{ errorMessage }}</p>
    </div>
    
    <!-- Dashboard Layout -->
    <ejs-dashboardlayout 
      *ngIf="!isLoading && !errorMessage"
      [columns]="6"
      [cellSpacing]="[10, 10]"
      [allowResizing]="true"
      [allowDragging]="true">
      
      <!-- Panel de estadísticas generales -->
      <div id="stats-panel" class="e-panel" data-row="0" data-col="0" 
           data-sizeX="2" data-sizeY="1">
        <div class="e-panel-container">
          <div class="panel-header">Estadísticas Temporada</div>
          <div class="stats-grid">
            <div class="stat-item">
              <h3>{{ totalRaces }}</h3>
              <p>Grandes Premios</p>
            </div>
            <div class="stat-item">
              <h3>{{ totalSessions }}</h3>
              <p>Sesiones Totales</p>
            </div>
            <div class="stat-item">
              <h3>{{ countries.length }}</h3>
              <p>Países</p>
            </div>
          </div>
        </div>
      </div>
  
      <!-- Panel de gráfico de tipos de sesión -->
      <div id="chart-panel" class="e-panel" data-row="0" data-col="2" 
           data-sizeX="4" data-sizeY="2">
        <div class="e-panel-container">
          <div class="panel-header">Distribución de Sesiones por Tipo</div>
          <ejs-chart 
            [primaryXAxis]="{ valueType: 'Category', labelRotation: -45 }"
            [primaryYAxis]="{ title: 'Cantidad' }"
            [title]="'Tipos de Sesión'"
            [tooltip]="{ enable: true }">
            <e-series-collection>
              <e-series 
                [dataSource]="chartData" 
                type="Column" 
                xName="type" 
                yName="count"
                [marker]="{ dataLabel: { visible: true } }">
              </e-series>
            </e-series-collection>
          </ejs-chart>
        </div>
      </div>
  
      <!-- Panel de lista de Grandes Premios -->
      <div id="meetings-panel" class="e-panel" data-row="1" data-col="0" 
           data-sizeX="3" data-sizeY="2">
        <div class="e-panel-container">
          <div class="panel-header">Calendario de Grandes Premios</div>
          <ejs-grid 
            [dataSource]="meetings" 
            [allowPaging]="true"
            [pageSettings]="{ pageSize: 8 }"
            [allowSorting]="true">
            <e-columns>
              <e-column field="Name" headerText="Gran Premio" width="200"></e-column>
              <e-column field="Location" headerText="Ubicación" width="150"></e-column>
              <e-column field="Country.Name" headerText="País" width="120"></e-column>
              <e-column field="Sessions.length" headerText="Sesiones" width="80"></e-column>
            </e-columns>
          </ejs-grid>
        </div>
      </div>
  
      <!-- Panel de todas las sesiones -->
      <div id="sessions-panel" class="e-panel" data-row="1" data-col="3" 
           data-sizeX="3" data-sizeY="2">
        <div class="e-panel-container">
          <div class="panel-header">Todas las Sesiones</div>
          <ejs-grid 
            [dataSource]="allSessions" 
            [allowPaging]="true"
            [pageSettings]="{ pageSize: 8 }"
            [allowSorting]="true"
            [allowFiltering]="true"
            (rowSelected)="onRowSelected($event)">
            <e-columns>
              <e-column field="meetingName" headerText="Gran Premio" width="180"></e-column>
              <e-column field="sessionType" headerText="Tipo" width="100"></e-column>
              <e-column field="country" headerText="País" width="120"></e-column>
            </e-columns>
          </ejs-grid>
        </div>
      </div>
  
      <!-- Panel de detalles de sesión seleccionada -->
      <div id="session-details-panel" class="e-panel" data-row="3" data-col="0" 
           data-sizeX="6" data-sizeY="2">
        <div class="e-panel-container">
          <div class="panel-header">Detalles de Sesión</div>
          
          <!-- Estado vacío -->
          <div *ngIf="!selectedSession" class="empty-state">
            <p>Selecciona una sesión para ver sus detalles</p>
          </div>
          
          <!-- Detalles de la sesión -->
          <div *ngIf="selectedSession && sessionDetails">
            <h3>{{ selectedSession.meetingName }} - {{ selectedSession.sessionType }}</h3>
            <p><strong>Path:</strong> {{ selectedSession.path }}</p>
            
            <div class="feeds-section">
              <h4>Feeds Disponibles ({{ getAvailableFeeds().length }}):</h4>
              <div class="feeds-grid">
                <div *ngFor="let feed of getAvailableFeeds()" class="feed-item">
                  <strong>{{ feed }}</strong>
                  <p>KeyFrame: {{ sessionDetails.Feeds[feed].KeyFramePath }}</p>
                  <p>Stream: {{ sessionDetails.Feeds[feed].StreamPath }}</p>
                </div>
              </div>
            </div>
  
            <div *ngIf="sessionDetails.info" class="session-info">
              <h4>Información de la Sesión:</h4>
              <pre>{{ sessionDetails.info | json }}</pre>
            </div>
          </div>
        </div>
      </div>
      
    </ejs-dashboardlayout>
  </div>
  